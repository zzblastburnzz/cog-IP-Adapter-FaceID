# Configuration for Cog ⚙️
# Reference: https://github.com/replicate/cog/blob/main/docs/yaml.md
build:
  python_version: "3.10"
  gpu: true
  python_packages:
    # ⚠️ Pin NumPy 1.x để tương thích cv2/insightface/onnxruntime hiện tại
    - numpy==1.26.4

    # PyTorch CUDA 12.1 stack (ổn định trên Replicate)
    - torch==2.1.2+cu121 --index-url https://download.pytorch.org/whl/cu121
    - torchvision==0.16.2+cu121 --index-url https://download.pytorch.org/whl/cu121
    - xformers==0.0.23.post1
    - triton==2.1.0

    # Diffusers stack
    - diffusers==0.27.2
    - transformers==4.39.3
    - accelerate==0.28.0
    - safetensors==0.4.2
    - sentencepiece==0.1.99

    # Vision & Face
    - opencv-python-headless==4.9.0.80
    - insightface==0.7.3
    - onnxruntime-gpu==1.17.1
    - pillow==10.3.0

    # IP-Adapter (cài thẳng từ Git để tránh lệch version)
    - git+https://github.com/tencent-ailab/IP-Adapter.git@main

predict: "predict.py:Predictor"
